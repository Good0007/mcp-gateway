# 监控与日志页面设计

## 监控页面布局

```
┌────────────────────────────────────────────────┐
│  连接监控                                      │
├────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────┐ │
│  │ 🌐 Xiaozhi 连接                          │ │
│  │                                          │ │
│  │ 状态: 🟢 已连接                          │ │
│  │ 端点: wss://api.xiaozhi.me/mcp/          │ │
│  │ 在线时长: 2小时 15分钟                   │ │
│  │ 最后心跳: 2秒前                          │ │
│  │                                          │ │
│  │ [断开连接] [重新连接] [测试]            │ │
│  └──────────────────────────────────────────┘ │
│                                                │
│  ┌──────────────────────────────────────────┐ │
│  │ 📊 统计信息                              │ │
│  │                                          │ │
│  │ 已加载服务: 2 / 3                        │ │
│  │ 可用工具: 20                             │ │
│  │ 工具调用: 47 次                          │ │
│  │ 成功率: 95.7% (45/47)                    │ │
│  │ 平均响应: 234ms                          │ │
│  └──────────────────────────────────────────┘ │
│                                                │
│  ┌──────────────────────────────────────────┐ │
│  │ 🛠️ 工具列表                              │ │
│  │                                          │ │
│  │ [Calculator (6)]                         │ │
│  │  ✓ add         ✓ sub        ✓ mul       │ │
│  │  ✓ div         ✓ sqrt       ✓ mod       │ │
│  │                                          │ │
│  │ [Filesystem (14)]                        │ │
│  │  ✓ read_file           ✓ write_file     │ │
│  │  ✓ list_directory      ✓ search_files   │ │
│  │  ✓ get_file_info       ✓ create_dir     │ │
│  │  ... (展开更多)                          │ │
│  └──────────────────────────────────────────┘ │
└────────────────────────────────────────────────┘
```

## 实时日志页面

```
┌────────────────────────────────────────────────┐
│  [🔴 暂停] [清空] [下载] [过滤▼] [搜索...  ] │
├────────────────────────────────────────────────┤
│  ☑ INFO  ☑ WARN  ☑ ERROR  ☐ DEBUG             │
├────────────────────────────────────────────────┤
│  2026-02-15 14:23:45 [INFO]  Service started   │
│    → calculator (sse)                          │
│                                                │
│  2026-02-15 14:23:46 [INFO]  Connected         │
│    → wss://api.xiaozhi.me/mcp/                 │
│                                                │
│  2026-02-15 14:23:47 [INFO]  Initialize OK     │
│    → protocol: 2024-11-05                      │
│    → tools: 20                                 │
│                                                │
│  2026-02-15 14:24:01 [INFO]  Tool called       │
│    → add(a: 5, b: 3) = 8                       │
│                                                │
│  2026-02-15 14:25:15 [WARN]  Slow response     │
│    → search_files took 1234ms                  │
│                                                │
│  2026-02-15 14:26:30 [ERROR] Tool failed       │
│    → write_file: Permission denied             │
│    → /etc/protected.txt                        │
│                                                │
│  ▼ 自动滚动到底部                              │
└────────────────────────────────────────────────┘
```

## 日志详情弹窗

```
┌─────────────────────────────────────┐
│  日志详情                       [✕] │
├─────────────────────────────────────┤
│  时间: 2026-02-15 14:26:30          │
│  级别: ERROR                        │
│  来源: xiaozhi-connection.ts:234    │
│                                     │
│  消息:                              │
│  Tool execution failed              │
│                                     │
│  详情:                              │
│  {                                  │
│    "tool": "write_file",            │
│    "params": {                      │
│      "path": "/etc/protected.txt",  │
│      "content": "test"              │
│    },                               │
│    "error": "Permission denied"     │
│  }                                  │
│                                     │
│  调用栈:                            │
│  at ToolAggregator.callTool         │
│  at XiaozhiConnection.handleCall    │
│  at WebSocket.onMessage             │
│                                     │
│  [复制] [导出] [关闭]               │
└─────────────────────────────────────┘
```

## 性能图表

```
┌────────────────────────────────────────────────┐
│  📈 性能趋势 (最近1小时)                       │
├────────────────────────────────────────────────┤
│  工具调用数                                    │
│   ▁▂▃▅▆█▅▄▃▂▁                                 │
│   0                                        12  │
│                                                │
│  平均响应时间 (ms)                             │
│   ▂▂▃▃▄▅█▅▄▃▂                                 │
│   100                                     500  │
│                                                │
│  错误率 (%)                                    │
│   ▁▁▁▂▁▁▃▁▁▁▁                                 │
│   0                                         5  │
└────────────────────────────────────────────────┘
```

## 连接状态指示器

```tsx
// 顶部状态栏
┌────────────────────────────────────────────────┐
│ MCP Agent  🟢 运行中  |  ⚡ 20 工具  |  ⏱ 234ms │
└────────────────────────────────────────────────┘

// 状态颜色
🟢 运行中 (Connected)
🟡 连接中 (Connecting)
🔴 已断开 (Disconnected)
⚠️ 异常 (Error)
```

## WebSocket 实时推送

```typescript
// 客户端订阅事件
socket.on('connection:status', (data) => {
  // { status: 'connected', uptime: 12345 }
});

socket.on('service:status', (data) => {
  // { serviceId: 'calc', status: 'running' }
});

socket.on('tool:called', (data) => {
  // { tool: 'add', params: {...}, result: 8 }
});

socket.on('log:new', (data) => {
  // { level: 'info', message: '...', timestamp: ... }
});
```

## 日志过滤器

```
┌─────────────────────────────────────┐
│  日志过滤                           │
├─────────────────────────────────────┤
│  级别:                              │
│  ☑ DEBUG  ☑ INFO  ☑ WARN  ☑ ERROR │
│                                     │
│  来源:                              │
│  ☑ Connection  ☑ Services  ☑ Tools │
│                                     │
│  时间范围:                          │
│  ○ 最近5分钟                        │
│  ○ 最近1小时                        │
│  ● 最近24小时                       │
│  ○ 自定义...                        │
│                                     │
│  关键词:                            │
│  [_________________]               │
│                                     │
│  [应用] [重置]                      │
└─────────────────────────────────────┘
```

## 服务健康检查

```
┌────────────────────────────────────────────────┐
│  服务健康状态                                  │
├────────────────────────────────────────────────┤
│  🟢 Calculator                                 │
│     在线时长: 2小时15分                        │
│     调用次数: 23                               │
│     最后调用: 30秒前                           │
│     错误率: 0%                                 │
│                                                │
│  🟢 Filesystem                                 │
│     在线时长: 2小时15分                        │
│     调用次数: 24                               │
│     最后调用: 5秒前                            │
│     错误率: 4.2% (1/24)                        │
│                                                │
│  🔴 Memory                                     │
│     状态: 已停止                               │
│     最后错误: Connection refused               │
│     建议: 检查服务是否启动                     │
└────────────────────────────────────────────────┘
```

## 监控 API

```typescript
// 获取连接状态
GET /api/status
{
  "xiaozhi": {
    "connected": true,
    "uptime": 8100000,
    "lastPing": "2026-02-15T14:26:28Z"
  },
  "services": {
    "running": 2,
    "stopped": 1,
    "error": 0
  },
  "tools": {
    "total": 20,
    "calls": 47,
    "successRate": 0.957
  }
}

// 获取日志
GET /api/logs?level=error&limit=100&since=2026-02-15T00:00:00Z

// 获取性能指标
GET /api/metrics?period=1h
```
