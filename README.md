# MCP Agent

ä¸€ä¸ªå¼ºå¤§çš„ MCP (Model Context Protocol) ä»£ç†æœåŠ¡ï¼Œç”¨äºèšåˆå¤šä¸ª MCP æœåŠ¡å¹¶é€šè¿‡ç»Ÿä¸€çš„ WebSocket æ¥å£æš´éœ²ç»™å°æ™º AI åŠ©æ‰‹ã€‚

> ğŸš€ **åŒ…ç®¡ç†**: æœ¬é¡¹ç›®ä½¿ç”¨ [Bun](https://bun.sh) ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œæä¾›æ›´å¿«çš„å®‰è£…é€Ÿåº¦å’Œæ›´å¥½çš„æ€§èƒ½ã€‚
> 
> âš¡ **å¿«é€Ÿå¼€å§‹**: æŸ¥çœ‹ [QUICKSTART.md](./QUICKSTART.md) ç«‹å³å¯åŠ¨ä¸»æœåŠ¡è¿›è¡ŒçœŸæœºè°ƒè¯•ï¼

## âœ¨ ç‰¹æ€§

- âœ… **å¤šé€‚é…å™¨æ”¯æŒ**: æ”¯æŒ 4 ç§ MCP æœåŠ¡ç±»å‹
  - `stdio`: å­è¿›ç¨‹é€šä¿¡ï¼ˆå…¼å®¹æ ‡å‡† MCP æœåŠ¡ï¼Œå¦‚ npxï¼‰
  - `embedded`: è¿›ç¨‹å†…æœåŠ¡ï¼ˆæ€§èƒ½æœ€ä½³ï¼Œå¯åŠ¨å¿« 30 å€ï¼‰
  - `sse`: Server-Sent Events
  - `http`: REST API
  
- âœ… **åŠ¨æ€æœåŠ¡ç®¡ç†**: è¿è¡Œæ—¶åŠ è½½/å¸è½½æœåŠ¡ï¼Œæ— éœ€é‡å¯
- âœ… **é…ç½®çƒ­é‡è½½**: ç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨åº”ç”¨æ›´æ–°
- âœ… **å·¥å…·èšåˆ**: è‡ªåŠ¨èšåˆæ‰€æœ‰æœåŠ¡çš„å·¥å…·åˆ—è¡¨
- âœ… **è‡ªåŠ¨é‡è¿**: WebSocket è¿æ¥æ–­å¼€è‡ªåŠ¨é‡è¿
- âœ… **å®Œæ•´ç±»å‹å®šä¹‰**: TypeScript ä¸¥æ ¼æ¨¡å¼ï¼Œå®Œå–„çš„ç±»å‹ç³»ç»Ÿ
- âœ… **ç»“æ„åŒ–æ—¥å¿—**: Winston æ—¥å¿—æ¡†æ¶ï¼Œæ”¯æŒæ–‡ä»¶å’Œæ§åˆ¶å°è¾“å‡º

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# å®‰è£…ä¾èµ–
bun install

# ç¼–è¯‘é¡¹ç›®
bun run build

# å¯åŠ¨æœåŠ¡ï¼ˆé»˜è®¤é…ç½®ï¼‰
bun start

# æˆ–æŒ‡å®šé…ç½®æ–‡ä»¶
bun start -- --config=./my-config.json

# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
bun run dev
```

é…ç½®æ–‡ä»¶ç¤ºä¾‹ `config/agent-config.json`:

```json
{
  "xiaozhi": {
    "endpoint": "wss://api.xiaozhi.me/mcp/?token=YOUR_TOKEN"
  },
  "services": [
    {
      "id": "calculator",
      "type": "sse",
      "name": "Calculator",
      "enabled": true,
      "url": "http://localhost:8931/sse"
    },
    {
      "id": "filesystem-npx",
      "type": "stdio",
      "name": "Filesystem Service",
      "enabled": true,
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/Users/yourname"],
      "cwd": "/Users/yourname"
    }
  ]
}
```

**ç¯å¢ƒå˜é‡æ”¯æŒ**ï¼šå¯ä»¥ç”¨ `MCP_ENDPOINT` ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„ endpointã€‚

## ğŸ“ æ¶æ„

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          xiaozhi AI (WebSocket)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        XiaozhiConnection (MCPåè®®)           â”‚
â”‚  - WebSocket è¿æ¥ç®¡ç†                        â”‚
â”‚  - MCP JSON-RPC æ¶ˆæ¯è·¯ç”±                     â”‚
â”‚  - è‡ªåŠ¨é‡è¿æœºåˆ¶                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ToolAggregator                    â”‚
â”‚  - å·¥å…·å‘ç°ä¸èšåˆ                            â”‚
â”‚  - å·¥å…·è°ƒç”¨è·¯ç”±                              â”‚
â”‚  - å‚æ•°æ˜ å°„ï¼ˆkeywordâ†’patternç­‰ï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ServiceRegistry                    â”‚
â”‚  - æœåŠ¡æ³¨å†Œä¸ç®¡ç†                            â”‚
â”‚  - ç”Ÿå‘½å‘¨æœŸæ§åˆ¶                              â”‚
â”‚  - å¥åº·æ£€æŸ¥                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚   â”‚   â”‚   â”‚
    â”Œâ”€â”€â”€â”€â”€â”˜   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”
    â”‚         â”‚   â”‚         â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â–¼â”€â” â”Œâ–¼â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”
â”‚Stdio â”‚  â”‚Emb â”‚ â”‚SSEâ”‚  â”‚HTTP  â”‚
â”‚      â”‚  â”‚    â”‚ â”‚   â”‚  â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„

```
mcp-agent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ types/           # ç±»å‹å®šä¹‰ï¼ˆMCPåè®®ã€é…ç½®ã€é”™è¯¯ï¼‰
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°ï¼ˆæ—¥å¿—ã€éªŒè¯ï¼‰
â”‚   â”œâ”€â”€ adapters/        # æœåŠ¡é€‚é…å™¨ï¼ˆ4ç§ç±»å‹ï¼‰
â”‚   â”œâ”€â”€ core/            # æ ¸å¿ƒæ¨¡å—ï¼ˆæ³¨å†Œè¡¨ã€èšåˆå™¨ã€è¿æ¥ç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ config/          # é…ç½®ç®¡ç†ï¼ˆåŠ è½½å™¨ã€çƒ­é‡è½½ï¼‰
â”‚   â””â”€â”€ cli.ts           # å‘½ä»¤è¡Œå…¥å£
â”‚
â”œâ”€â”€ examples/            # ç¤ºä¾‹æœåŠ¡
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ tests/               # æµ‹è¯•ï¼ˆ64ä¸ªå•å…ƒæµ‹è¯•ï¼‰
â””â”€â”€ docs/                # æ–‡æ¡£
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### æ·»åŠ æœåŠ¡

æŸ¥çœ‹é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š
- [agent-config.json](./config/agent-config.json) - å½“å‰ä½¿ç”¨çš„é…ç½®
- [multi-services-example.json](./config/multi-services-example.json) - å¤šæœåŠ¡ç¤ºä¾‹

æ”¯æŒçš„æœåŠ¡ç±»å‹ï¼š

**1. Stdioï¼ˆnpxæ”¯æŒï¼‰**
```json
{
  "type": "stdio",
  "command": "npx",
  "args": ["-y", "@modelcontextprotocol/server-memory"]
}
```

**2. SSE**
```json
{
  "type": "sse",
  "url": "http://localhost:8931/sse"
}
```

**3. Embedded**
```json
{
  "type": "embedded",
  "modulePath": "./dist/services/my-service.js"
}
```

**4. HTTP**
```json
{
  "type": "http",
  "baseUrl": "http://localhost:4000/mcp"
}
```

### ç›‘å¬äº‹ä»¶

```typescript
import { MCPAgent } from 'mcp-agent';

const agent = new MCPAgent('./config.json');

agent.on('agent:ready', () => {
  console.log('Agent ready!');
});

agent.on('agent:error', (error) => {
  console.error('Error:', error);
});

await agent.start();
```

## ğŸ§ª å¼€å‘

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
bun test

# è¦†ç›–ç‡æŠ¥å‘Š
bun run test:coverage

# è¿è¡Œç‰¹å®šæµ‹è¯•
bun test tests/unit/utils/logger.test.ts
```

**æµ‹è¯•çŠ¶æ€**: âœ… 64 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### ä»£ç è´¨é‡

```bash
# ESLint æ£€æŸ¥
bun run lint

# ESLint è‡ªåŠ¨ä¿®å¤
bun run lint:fix

# Prettier æ ¼å¼åŒ–
bun run format

# ç±»å‹æ£€æŸ¥
bun run typecheck

# ä¸€é”®æ£€æŸ¥
bun run build  # åŒ…å« lint + typecheck
```

### æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | Embedded | Stdio (npx) |
|------|----------|-------------|
| å¯åŠ¨æ—¶é—´ | ~100ms | ~3000ms |
| å†…å­˜å¼€é”€ | å…±äº«è¿›ç¨‹ | ç‹¬ç«‹è¿›ç¨‹ |
| é€šä¿¡å»¶è¿Ÿ | å‡½æ•°è°ƒç”¨ | IPC |
| éš”ç¦»æ€§ | ä½ | é«˜ |

**å»ºè®®**: 
- é«˜é¢‘è°ƒç”¨ â†’ `embedded`
- ç¬¬ä¸‰æ–¹æœåŠ¡ â†’ `stdio`
- è¿œç¨‹æœåŠ¡ â†’ `sse` / `http`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [QUICKSTART.md](./QUICKSTART.md) - å¿«é€Ÿå¼€å§‹æŒ‡å—
- [MULTI_SERVICES.md](./docs/MULTI_SERVICES.md) - å¤šæœåŠ¡é›†æˆæŒ‡å—
- [QUICK_TEST.md](./docs/QUICK_TEST.md) - å¿«é€Ÿæµ‹è¯•æŒ‡å—

æŠ€æœ¯æ–‡æ¡£ï¼š
- [æ¶æ„æ–‡æ¡£](./docs/ARCHITECTURE.md)
- [æŠ€æœ¯è§„èŒƒ](./docs/TECHNICAL_SPEC.md)
- [å®ç°è®¡åˆ’](./docs/IMPLEMENTATION_PLAN.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT

## ğŸ™ è‡´è°¢

- [Model Context Protocol](https://modelcontextprotocol.io/)
- [å°æ™º AI](https://xiaozhi.ai/)
- [Anthropic MCP Servers](https://github.com/modelcontextprotocol)
